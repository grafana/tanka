(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{qTU8:function(e,a,t){"use strict";t.r(a),t.d(a,"_frontmatter",(function(){return r})),t.d(a,"default",(function(){return o}));var n=t("wx14"),s=t("zLVn"),c=(t("q1tI"),t("7ljp")),m=t("BIGe"),p=t("Z+0r"),l=(t("qKvR"),["components"]),r={};void 0!==r&&r&&r===Object(r)&&Object.isExtensible(r)&&!Object.prototype.hasOwnProperty.call(r,"__filemeta")&&Object.defineProperty(r,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"docs/tutorial/parameterizing.mdx"}});var b={_frontmatter:r},i=m.a;function o(e){var a=e.components,t=Object(s.a)(e,l);return Object(c.b)(i,Object(n.a)({},b,t,{components:a,mdxType:"MDXLayout"}),Object(c.b)("h1",{id:"parameterizing"},"Parameterizing"),Object(c.b)("p",null,"Deploying using Tanka worked well, but it did not really improve the situation\nin terms of maintainability and readability."),Object(c.b)("p",null,"To do so, the following sections will explore some ways Jsonnet provides us with."),Object(c.b)("h2",{id:"config-object"},"Config object"),Object(c.b)("p",null,"The most straightforward thing to do is creating a hidden object that holds all\nactual values in a single place to be consumed by the actual resources."),Object(c.b)("p",null,"Luckily, Jsonnet has the ",Object(c.b)("inlineCode",{parentName:"p"},'key:: "value"')," stanza for private fields. Such are\nonly available during compiling and will be removed from the actual output."),Object(c.b)("p",null,"Such an object could look like this:"),Object(c.b)("pre",{className:"material-theme-darker vscode-highlight","data-language":"jsonnet"},Object(c.b)("code",{parentName:"pre",className:"vscode-highlight-code"},Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"{")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"  "),Object(c.b)("span",{parentName:"span",className:"mtk7"},"_config::"),Object(c.b)("span",{parentName:"span",className:"mtk1"}," {")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"    "),Object(c.b)("span",{parentName:"span",className:"mtk10"},"grafana:"),Object(c.b)("span",{parentName:"span",className:"mtk1"}," {")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"      "),Object(c.b)("span",{parentName:"span",className:"mtk10"},"port:"),Object(c.b)("span",{parentName:"span",className:"mtk1"}," "),Object(c.b)("span",{parentName:"span",className:"mtk4"},"3000"),Object(c.b)("span",{parentName:"span",className:"mtk1"},",")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"      "),Object(c.b)("span",{parentName:"span",className:"mtk10"},"name:"),Object(c.b)("span",{parentName:"span",className:"mtk1"}," "),Object(c.b)("span",{parentName:"span",className:"mtk6"},'"grafana"'),Object(c.b)("span",{parentName:"span",className:"mtk1"},",")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"    },")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"    "),Object(c.b)("span",{parentName:"span",className:"mtk10"},"prometheus:"),Object(c.b)("span",{parentName:"span",className:"mtk1"}," {")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"      "),Object(c.b)("span",{parentName:"span",className:"mtk10"},"port:"),Object(c.b)("span",{parentName:"span",className:"mtk1"}," "),Object(c.b)("span",{parentName:"span",className:"mtk4"},"9090"),Object(c.b)("span",{parentName:"span",className:"mtk1"},",")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"      "),Object(c.b)("span",{parentName:"span",className:"mtk10"},"name:"),Object(c.b)("span",{parentName:"span",className:"mtk1"}," "),Object(c.b)("span",{parentName:"span",className:"mtk6"},'"prometheus"')),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"    }")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"  }")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"}")))),Object(c.b)("p",null,"We can then replace hardcoded values with a reference to this object:"),Object(c.b)("pre",{className:"material-theme-darker vscode-highlight","data-language":"diff"},Object(c.b)("code",{parentName:"pre",className:"vscode-highlight-code"},Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"{ // <- This is $")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"  _config:: { /* .. */ },")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"  grafana: {")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"    service: {")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"      apiVersion: 'v1',")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"      kind: 'Service',")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"      metadata: {")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"        labels: {")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"-"),Object(c.b)("span",{parentName:"span",className:"mtk10"},"         name: 'grafana',")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"+"),Object(c.b)("span",{parentName:"span",className:"mtk6"},"         name: $._config.grafana.name, // $ refers to the outermost object")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"        },")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"-"),Object(c.b)("span",{parentName:"span",className:"mtk10"},"       name: 'grafana',")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"+"),Object(c.b)("span",{parentName:"span",className:"mtk6"},"       name: $._config.grafana.name,")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"      },")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"      spec: {")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"        ports: [{")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"-"),Object(c.b)("span",{parentName:"span",className:"mtk10"},"           name: 'grafana-ui',")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"+"),Object(c.b)("span",{parentName:"span",className:"mtk6"},"           name: '%s-ui' % $._config.grafana.name, // printf-style formatting")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"-"),Object(c.b)("span",{parentName:"span",className:"mtk10"},"           port: 3000,")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"+"),Object(c.b)("span",{parentName:"span",className:"mtk6"},"           port: $._config.grafana.port,")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"-"),Object(c.b)("span",{parentName:"span",className:"mtk10"},"           targetPort: 3000,")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"+"),Object(c.b)("span",{parentName:"span",className:"mtk6"},"           targetPort: $._config.grafana.port,")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"        }],")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"        selector: {")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"-"),Object(c.b)("span",{parentName:"span",className:"mtk10"},"          name: 'grafana',")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk5"},"+"),Object(c.b)("span",{parentName:"span",className:"mtk6"},"          name: $._config.grafana.name,")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"        },")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"        type: 'NodePort',")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"      },")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"    },")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"  },")),"\n",Object(c.b)("span",{parentName:"code",className:"vscode-highlight-line"},Object(c.b)("span",{parentName:"span",className:"mtk1"},"}")))),Object(c.b)("p",null,"Here we see that we can easily refer to other parts of the configuration using\nthe outer-most object ",Object(c.b)("inlineCode",{parentName:"p"},"$")," (the root level). Every value is just a regular\nvariable that you can refer to using the same familiar syntax from other C-like\nlanguages."),Object(c.b)("p",null,"Now we do not only have a single place to change tunables, but also won't suffer\nfrom mismatching labels and selectors anymore, as they are defined in a single\nplace and all changed at once."),Object(c.b)(p.a,{prev:"/tutorial/jsonnet",next:"/tutorial/abstraction",mdxType:"TutorialButtons"}),Object(c.b)("style",{className:"vscode-highlight-styles"},"\n  \n  .material-theme-darker {\nbackground-color: #212121;\ncolor: #EEFFFF;\n}\n\n.material-theme-darker .mtk1 { color: #FFFFFF; }\n.material-theme-darker .mtk2 { color: #212121; }\n.material-theme-darker .mtk3 { color: #545454; }\n.material-theme-darker .mtk4 { color: #F78C6C; }\n.material-theme-darker .mtk5 { color: #89DDFF; }\n.material-theme-darker .mtk6 { color: #C3E88D; }\n.material-theme-darker .mtk7 { color: #FFCB6B; }\n.material-theme-darker .mtk8 { color: #EEFFFF; }\n.material-theme-darker .mtk9 { color: #82AAFF; }\n.material-theme-darker .mtk10 { color: #FF5370; }\n.material-theme-darker .mtk11 { color: #F07178; }\n.material-theme-darker .mtk12 { color: #C792EA; }\n.material-theme-darker .mtk13 { color: #EEFFFF90; }\n.material-theme-darker .mtk14 { color: #65737E; }\n.material-theme-darker .mtk15 { color: #B2CCD6; }\n.material-theme-darker .mtk16 { color: #C17E70; }\n.material-theme-darker .mtki { font-style: italic; }\n.material-theme-darker .mtkb { font-weight: bold; }\n.material-theme-darker .mtku { text-decoration: underline; text-underline-position: under; }\n"))}void 0!==o&&o&&o===Object(o)&&Object.isExtensible(o)&&!Object.prototype.hasOwnProperty.call(o,"__filemeta")&&Object.defineProperty(o,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"docs/tutorial/parameterizing.mdx"}}),o.isMDXComponent=!0}}]);
//# sourceMappingURL=component---docs-tutorial-parameterizing-mdx-83b8222ca11b7ba7fa71.js.map