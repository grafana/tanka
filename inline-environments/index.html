<!DOCTYPE html><html lang="en" dir="ltr" data-has-toc="true" data-has-sidebar="true" data-has-hero="false" data-theme="dark" class="astro-vikcuohw"> <head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Inline environments | Grafana Tanka</title><link rel="canonical" href="https://tanka.dev/inline-environments/"/><link rel="sitemap" href="/sitemap-index.xml"/><base href="https://tanka.dev"/><link rel="shortcut icon" href="/favicon.svg" type="image/svg+xml"/><meta name="generator" content="Astro v4.11.4"/><meta name="generator" content="Starlight v0.24.5"/><meta property="og:title" content="Inline environments"/><meta property="og:type" content="article"/><meta property="og:url" content="https://tanka.dev/inline-environments/"/><meta property="og:locale" content="en"/><meta property="og:description" content="Grafana Tanka is the robust configuration utility for your Kubernetes cluster, powered by the Jsonnet language."/><meta property="og:site_name" content="Grafana Tanka"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Inline environments"/><meta name="twitter:description" content="Grafana Tanka is the robust configuration utility for your Kubernetes cluster, powered by the Jsonnet language."/><meta name="description" content="Grafana Tanka is the robust configuration utility for your Kubernetes cluster, powered by the Jsonnet language."/><script>
	window.StarlightThemeProvider = (() => {
		const storedTheme =
			typeof localStorage !== 'undefined' && localStorage.getItem('starlight-theme');
		const theme =
			storedTheme ||
			(window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
		document.documentElement.dataset.theme = theme === 'light' ? 'light' : 'dark';
		return {
			updatePickers(theme = storedTheme || 'auto') {
				document.querySelectorAll('starlight-theme-select').forEach((picker) => {
					const select = picker.querySelector('select');
					if (select) select.value = theme;
					/** @type {HTMLTemplateElement | null} */
					const tmpl = document.querySelector(`#theme-icons`);
					const newIcon = tmpl && tmpl.content.querySelector('.' + theme);
					if (newIcon) {
						const oldIcon = picker.querySelector('svg.label-icon');
						if (oldIcon) {
							oldIcon.replaceChildren(...newIcon.cloneNode(true).childNodes);
						}
					}
				});
			},
		};
	})();
</script><template id="theme-icons"><svg aria-hidden="true" class="light astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M5 12a1 1 0 0 0-1-1H3a1 1 0 0 0 0 2h1a1 1 0 0 0 1-1Zm.64 5-.71.71a1 1 0 0 0 0 1.41 1 1 0 0 0 1.41 0l.71-.71A1 1 0 0 0 5.64 17ZM12 5a1 1 0 0 0 1-1V3a1 1 0 0 0-2 0v1a1 1 0 0 0 1 1Zm5.66 2.34a1 1 0 0 0 .7-.29l.71-.71a1 1 0 1 0-1.41-1.41l-.66.71a1 1 0 0 0 0 1.41 1 1 0 0 0 .66.29Zm-12-.29a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.71-.71a1.004 1.004 0 1 0-1.43 1.41l.73.71ZM21 11h-1a1 1 0 0 0 0 2h1a1 1 0 0 0 0-2Zm-2.64 6A1 1 0 0 0 17 18.36l.71.71a1 1 0 0 0 1.41 0 1 1 0 0 0 0-1.41l-.76-.66ZM12 6.5a5.5 5.5 0 1 0 5.5 5.5A5.51 5.51 0 0 0 12 6.5Zm0 9a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7Zm0 3.5a1 1 0 0 0-1 1v1a1 1 0 0 0 2 0v-1a1 1 0 0 0-1-1Z"/></svg> <svg aria-hidden="true" class="dark astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.64 13a1 1 0 0 0-1.05-.14 8.049 8.049 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05Zm-9.5 6.69A8.14 8.14 0 0 1 7.08 5.22v.27a10.15 10.15 0 0 0 10.14 10.14 9.784 9.784 0 0 0 2.1-.22 8.11 8.11 0 0 1-7.18 4.32v-.04Z"/></svg> <svg aria-hidden="true" class="auto astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg> </template><link rel="stylesheet" href="/_astro/index.BgbCpq8-.css">
<style>:root{--sl-badge-default-border: var(--sl-color-accent);--sl-badge-default-bg: var(--sl-color-accent-low);--sl-badge-default-text: #fff;--sl-badge-note-border: var(--sl-color-blue);--sl-badge-note-bg: var(--sl-color-blue-low);--sl-badge-note-text: #fff;--sl-badge-danger-border: var(--sl-color-red);--sl-badge-danger-bg: var(--sl-color-red-low);--sl-badge-danger-text: #fff;--sl-badge-success-border: var(--sl-color-green);--sl-badge-success-bg: var(--sl-color-green-low);--sl-badge-success-text: #fff;--sl-badge-caution-border: var(--sl-color-orange);--sl-badge-caution-bg: var(--sl-color-orange-low);--sl-badge-caution-text: #fff;--sl-badge-tip-border: var(--sl-color-purple);--sl-badge-tip-bg: var(--sl-color-purple-low);--sl-badge-tip-text: #fff}[data-theme=light]:root{--sl-badge-default-bg: var(--sl-color-accent-high);--sl-badge-note-bg: var(--sl-color-blue-high);--sl-badge-danger-bg: var(--sl-color-red-high);--sl-badge-success-bg: var(--sl-color-green-high);--sl-badge-caution-bg: var(--sl-color-orange-high);--sl-badge-tip-bg: var(--sl-color-purple-high)}.sl-badge:where(.astro-efnyzxca){display:inline-block;border:1px solid var(--sl-color-border-badge);border-radius:.25rem;font-family:var(--sl-font-system-mono);line-height:normal;color:var(--sl-color-text-badge);background-color:var(--sl-color-bg-badge);overflow-wrap:anywhere}.sidebar-content .sl-badge:where(.astro-efnyzxca){line-height:1;font-size:var(--sl-text-xs);padding:.125rem .375rem}.sidebar-content a[aria-current=page]>.sl-badge:where(.astro-efnyzxca){--sl-color-bg-badge: transparent;--sl-color-border-badge: currentColor;color:inherit}.default:where(.astro-efnyzxca){--sl-color-bg-badge: var(--sl-badge-default-bg);--sl-color-border-badge: var(--sl-badge-default-border);--sl-color-text-badge: var(--sl-badge-default-text)}.note:where(.astro-efnyzxca){--sl-color-bg-badge: var(--sl-badge-note-bg);--sl-color-border-badge: var(--sl-badge-note-border);--sl-color-text-badge: var(--sl-badge-note-text)}.danger:where(.astro-efnyzxca){--sl-color-bg-badge: var(--sl-badge-danger-bg);--sl-color-border-badge: var(--sl-badge-danger-border);--sl-color-text-badge: var(--sl-badge-danger-text)}.success:where(.astro-efnyzxca){--sl-color-bg-badge: var(--sl-badge-success-bg);--sl-color-border-badge: var(--sl-badge-success-border);--sl-color-text-badge: var(--sl-badge-success-text)}.tip:where(.astro-efnyzxca){--sl-color-bg-badge: var(--sl-badge-tip-bg);--sl-color-border-badge: var(--sl-badge-tip-border);--sl-color-text-badge: var(--sl-badge-tip-text)}.caution:where(.astro-efnyzxca){--sl-color-bg-badge: var(--sl-badge-caution-bg);--sl-color-border-badge: var(--sl-badge-caution-border);--sl-color-text-badge: var(--sl-badge-caution-text)}.small:where(.astro-efnyzxca){font-size:var(--sl-text-xs);padding:.125rem .25rem}.medium:where(.astro-efnyzxca){font-size:var(--sl-text-sm);padding:.175rem .35rem}.large:where(.astro-efnyzxca){font-size:var(--sl-text-base);padding:.225rem .45rem}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6) .sl-badge:where(.astro-efnyzxca){vertical-align:middle}
.card-grid:where(.astro-f24ej7fz){display:grid;gap:1rem}.card-grid:where(.astro-f24ej7fz)>*{margin-top:0!important}@media (min-width: 50rem){.card-grid:where(.astro-f24ej7fz){grid-template-columns:1fr 1fr;gap:1.5rem}.stagger:where(.astro-f24ej7fz){--stagger-height: 5rem;padding-bottom:var(--stagger-height)}.stagger:where(.astro-f24ej7fz)>*:nth-child(2n){transform:translateY(var(--stagger-height))}}
.card:where(.astro-egmwxrfo){--sl-card-border: var(--sl-color-purple);--sl-card-bg: var(--sl-color-purple-low);border:1px solid var(--sl-color-gray-5);background-color:var(--sl-color-black);padding:clamp(1rem,calc(.125rem + 3vw),2.5rem);flex-direction:column;gap:clamp(.5rem,calc(.125rem + 1vw),1rem)}.card:where(.astro-egmwxrfo):nth-child(4n+1){--sl-card-border: var(--sl-color-orange);--sl-card-bg: var(--sl-color-orange-low)}.card:where(.astro-egmwxrfo):nth-child(4n+3){--sl-card-border: var(--sl-color-green);--sl-card-bg: var(--sl-color-green-low)}.card:where(.astro-egmwxrfo):nth-child(4n+4){--sl-card-border: var(--sl-color-red);--sl-card-bg: var(--sl-color-red-low)}.card:where(.astro-egmwxrfo):nth-child(4n+5){--sl-card-border: var(--sl-color-blue);--sl-card-bg: var(--sl-color-blue-low)}.title:where(.astro-egmwxrfo){font-weight:600;font-size:var(--sl-text-h4);color:var(--sl-color-white);line-height:var(--sl-line-height-headings);gap:1rem;align-items:center}.card:where(.astro-egmwxrfo) .icon:where(.astro-egmwxrfo){border:1px solid var(--sl-card-border);background-color:var(--sl-card-bg);padding:.2em;border-radius:.25rem}.card:where(.astro-egmwxrfo) .body:where(.astro-egmwxrfo){margin:0;font-size:clamp(var(--sl-text-sm),calc(.5rem + 1vw),var(--sl-text-body))}
svg:where(.astro-vmjkirbm){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1em;height:1em}
starlight-tabs:where(.astro-y637vobc){display:block}.tablist-wrapper:where(.astro-y637vobc){overflow-x:auto}:where(.astro-y637vobc)[role=tablist]{display:flex;list-style:none;border-bottom:2px solid var(--sl-color-gray-5);padding:0}.tab:where(.astro-y637vobc){margin-bottom:-2px}.tab:where(.astro-y637vobc)>:where(.astro-y637vobc)[role=tab]{display:flex;align-items:center;gap:.5rem;padding:0 1.25rem;text-decoration:none;border-bottom:2px solid var(--sl-color-gray-5);color:var(--sl-color-gray-3);outline-offset:var(--sl-outline-offset-inside);overflow-wrap:initial}.tab:where(.astro-y637vobc) :where(.astro-y637vobc)[role=tab][aria-selected=true]{color:var(--sl-color-white);border-color:var(--sl-color-text-accent);font-weight:600}.tablist-wrapper:where(.astro-y637vobc)~[role=tabpanel]{margin-top:1rem}
.sl-steps{--bullet-size: calc(var(--sl-line-height) * 1rem);--bullet-margin: .375rem;list-style:none;counter-reset:steps-counter var(--sl-steps-start, 0);padding-inline-start:0}.sl-steps>li{counter-increment:steps-counter;position:relative;padding-inline-start:calc(var(--bullet-size) + 1rem);padding-bottom:1px;min-height:calc(var(--bullet-size) + var(--bullet-margin))}.sl-steps>li+li{margin-top:0}.sl-steps>li:before{content:counter(steps-counter);position:absolute;top:0;inset-inline-start:0;width:var(--bullet-size);height:var(--bullet-size);line-height:var(--bullet-size);font-size:var(--sl-text-xs);font-weight:600;text-align:center;color:var(--sl-color-white);background-color:var(--sl-color-gray-6);border-radius:99rem;box-shadow:inset 0 0 0 1px var(--sl-color-gray-5)}.sl-steps>li:not(:last-of-type):after{--guide-width: 1px;content:"";position:absolute;top:calc(var(--bullet-size) + var(--bullet-margin));bottom:var(--bullet-margin);inset-inline-start:calc((var(--bullet-size) - var(--guide-width)) / 2);width:var(--guide-width);background-color:var(--sl-color-hairline-light)}.sl-steps>li>:first-child{--lh: calc(1em * var(--sl-line-height));--shift-y: calc(.5 * (var(--bullet-size) - var(--lh)));transform:translateY(var(--shift-y));margin-bottom:var(--shift-y)}.sl-steps>li>:first-child:where(h1,h2,h3,h4,h5,h6){--lh: calc(1em * var(--sl-line-height-headings))}@supports (--prop: 1lh){.sl-steps>li>:first-child{--lh: 1lh}}
starlight-file-tree:where(.astro-irhmq347){--x-space: 1.5rem;--y-space: .125rem;--y-pad: 0;display:block;border:1px solid var(--sl-color-gray-5);padding:1rem;background-color:var(--sl-color-gray-6);font-size:var(--sl-text-xs);font-family:var(--__sl-font-mono);overflow-x:auto}starlight-file-tree:where(.astro-irhmq347) .directory>details{border:0;padding:0;padding-inline-start:var(--x-space);background:transparent}starlight-file-tree:where(.astro-irhmq347) .directory>details>summary{margin-inline-start:calc(-1 * var(--x-space));border:0;padding:var(--y-pad) .625rem;font-weight:400;color:var(--sl-color-white);max-width:100%}starlight-file-tree:where(.astro-irhmq347) .directory>details>summary::marker,starlight-file-tree:where(.astro-irhmq347) .directory>details>summary::-webkit-details-marker{color:var(--sl-color-gray-3)}starlight-file-tree:where(.astro-irhmq347) .directory>details>summary:hover,starlight-file-tree:where(.astro-irhmq347) .directory>details>summary:hover .tree-icon{cursor:pointer;color:var(--sl-color-text-accent);fill:var(--sl-color-text-accent)}starlight-file-tree:where(.astro-irhmq347) .directory>details>summary:hover~ul{border-color:var(--sl-color-gray-4)}starlight-file-tree:where(.astro-irhmq347) .directory>details>summary:hover .highlight .tree-icon{fill:var(--sl-color-text-invert)}starlight-file-tree:where(.astro-irhmq347) ul{margin-inline-start:.5rem;border-inline-start:1px solid var(--sl-color-gray-5);padding:0;padding-inline-start:.125rem;list-style:none}starlight-file-tree:where(.astro-irhmq347)>ul{margin:0;border:0;padding:0}starlight-file-tree:where(.astro-irhmq347) li{margin:var(--y-space) 0;padding:var(--y-pad) 0}starlight-file-tree:where(.astro-irhmq347) .file{margin-inline-start:calc(var(--x-space) - .125rem);color:var(--sl-color-white)}starlight-file-tree:where(.astro-irhmq347) .tree-entry{display:inline-flex;align-items:flex-start;flex-wrap:wrap;max-width:calc(100% - 1rem)}@media (min-width: 30em){starlight-file-tree:where(.astro-irhmq347) .tree-entry{flex-wrap:nowrap}}starlight-file-tree:where(.astro-irhmq347) .tree-entry>:first-child{flex-shrink:0}starlight-file-tree:where(.astro-irhmq347) .empty{color:var(--sl-color-gray-3);padding-inline-start:.375rem}starlight-file-tree:where(.astro-irhmq347) .comment{color:var(--sl-color-gray-3);padding-inline-start:1.625rem;max-width:24rem;min-width:12rem}starlight-file-tree:where(.astro-irhmq347) .highlight{display:inline-block;border-radius:.25rem;padding-inline-end:.5rem;color:var(--sl-color-text-invert);background-color:var(--sl-color-text-accent)}starlight-file-tree:where(.astro-irhmq347) svg{display:inline;fill:var(--sl-color-gray-3);vertical-align:middle;margin-inline:.25rem .375rem;width:.875rem;height:.875rem}starlight-file-tree:where(.astro-irhmq347) .highlight svg.tree-icon{fill:var(--sl-color-text-invert)}
</style><script type="module" src="/_astro/hoisted.a3FU_qlU.js"></script>
<script type="module" src="/_astro/page.LS5KDvwX.js"></script><script src="/_astro/Tabs.astro_astro_type_script_index_0_lang.CCIyraCc.js" type="module"></script></head> <body class="astro-vikcuohw"> <a href="#_top" class="astro-lu6sucez">Skip to content</a>  <div class="page sl-flex astro-62xyixwj"> <header class="header astro-62xyixwj"><div class="header sl-flex astro-wb64d5mq"> <div class="title-wrapper sl-flex astro-wb64d5mq"> <a href="/" class="site-title sl-flex astro-esiqe42s">  <img class="astro-esiqe42s" alt="Grafana Tanka logo" src="/_astro/logo.D9L7aiSf.svg" width="144" height="69">  <span class="astro-esiqe42s"> Grafana Tanka </span> </a>  </div> <div class="sl-flex astro-wb64d5mq"> <site-search data-translations="{&#34;placeholder&#34;:&#34;Search&#34;}" data-strip-trailing-slash="false" class="astro-zzgxywmo"> <button data-open-modal disabled class="astro-zzgxywmo">  <svg aria-label="Search" class="astro-zzgxywmo astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.71 20.29 18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a.999.999 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z"/></svg>  <span class="sl-hidden md:sl-block astro-zzgxywmo" aria-hidden="true">Search</span> <svg aria-label="(Press / to Search)" class="sl-hidden md:sl-block astro-zzgxywmo astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 2H7a5 5 0 0 0-5 5v10a5 5 0 0 0 5 5h10a5 5 0 0 0 5-5V7a5 5 0 0 0-5-5Zm3 15a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10Z"/><path d="M15.293 6.707a1 1 0 1 1 1.414 1.414l-8.485 8.486a1 1 0 0 1-1.414-1.415l8.485-8.485Z"/></svg>  </button> <dialog style="padding:0" aria-label="Search" class="astro-zzgxywmo"> <div class="dialog-frame sl-flex astro-zzgxywmo">  <button data-close-modal class="sl-flex md:sl-hidden astro-zzgxywmo"> Cancel </button> <div class="search-container astro-zzgxywmo"> <div id="starlight__search" class="astro-zzgxywmo"></div> </div> </div> </dialog> </site-search>    </div> <div class="sl-hidden md:sl-flex right-group astro-wb64d5mq"> <div class="sl-flex social-icons astro-wb64d5mq"> <a href="https://github.com/grafana/tanka" rel="me" class="sl-flex astro-7k65stkl"><span class="sr-only astro-7k65stkl">GitHub</span><svg aria-hidden="true" class="astro-7k65stkl astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-hxjain2w"> <span class="sr-only astro-hxjain2w">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-hxjain2w astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-hxjain2w"> <option value="dark" selected="false" class="astro-hxjain2w">Dark</option><option value="light" selected="false" class="astro-hxjain2w">Light</option><option value="auto" selected="true" class="astro-hxjain2w">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-hxjain2w astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div> </div> </header> <nav class="sidebar astro-62xyixwj" aria-label="Main"> <starlight-menu-button class="astro-krvx4wia"> <button aria-expanded="false" aria-label="Menu" aria-controls="starlight__sidebar" class="sl-flex md:sl-hidden astro-krvx4wia"> <svg aria-hidden="true" class="astro-krvx4wia astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M3 8h18a1 1 0 1 0 0-2H3a1 1 0 0 0 0 2Zm18 8H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Zm0-5H3a1 1 0 0 0 0 2h18a1 1 0 0 0 0-2Z"/></svg>  </button> </starlight-menu-button>    <div id="starlight__sidebar" class="sidebar-pane astro-62xyixwj"> <div class="sidebar-content sl-flex astro-62xyixwj"> <ul class="top-level astro-xu75y2ov"> <li class="astro-xu75y2ov"> <a href="/install/" aria-current="false" class="large astro-xu75y2ov"> <span class="astro-xu75y2ov">Installation</span>  </a> </li><li class="astro-xu75y2ov"> <details class="astro-xu75y2ov"> <summary class="astro-xu75y2ov"> <div class="group-label astro-xu75y2ov"> <span class="large astro-xu75y2ov">Tutorial</span>  </div> <svg aria-hidden="true" class="caret astro-xu75y2ov astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-xu75y2ov"> <li class="astro-xu75y2ov"> <a href="/tutorial/overview/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Overview</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/tutorial/refresher/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Refresher on deploying</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/tutorial/jsonnet/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Using Jsonnet</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/tutorial/parameters/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Parameterizing</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/tutorial/abstraction/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Abstraction</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/tutorial/k-lib/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Kubernetes library</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/tutorial/environments/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Environments</span>  </a> </li> </ul>  </details> </li><li class="astro-xu75y2ov"> <details class="astro-xu75y2ov"> <summary class="astro-xu75y2ov"> <div class="group-label astro-xu75y2ov"> <span class="large astro-xu75y2ov">Writing Jsonnet</span>  </div> <svg aria-hidden="true" class="caret astro-xu75y2ov astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-xu75y2ov"> <li class="astro-xu75y2ov"> <a href="/jsonnet/overview/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Syntax overview</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/jsonnet/main/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">main.jsonnet</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/jsonnet/native/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Native Functions</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/jsonnet/injecting-values/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Injecting Values</span>  </a> </li> </ul>  </details> </li><li class="astro-xu75y2ov"> <details class="astro-xu75y2ov"> <summary class="astro-xu75y2ov"> <div class="group-label astro-xu75y2ov"> <span class="large astro-xu75y2ov">Libraries</span>  </div> <svg aria-hidden="true" class="caret astro-xu75y2ov astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-xu75y2ov"> <li class="astro-xu75y2ov"> <a href="/libraries/import-paths/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Import paths</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/libraries/install-publish/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Installing and publishing</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/libraries/overriding/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Overriding vendor</span>  </a> </li> </ul>  </details> </li><li class="astro-xu75y2ov"> <details open class="astro-xu75y2ov"> <summary class="astro-xu75y2ov"> <div class="group-label astro-xu75y2ov"> <span class="large astro-xu75y2ov">Advanced features</span>  </div> <svg aria-hidden="true" class="caret astro-xu75y2ov astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-xu75y2ov"> <li class="astro-xu75y2ov"> <a href="/garbage-collection/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Garbage collection</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/helm/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Helm support</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/kustomize/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Kustomize support</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/output-filtering/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Output filtering</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/exporting/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Exporting as YAML</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/inline-environments/" aria-current="page" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Inline environments</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/server-side-apply/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Server-Side Apply</span>  </a> </li> </ul>  </details> </li><li class="astro-xu75y2ov"> <details class="astro-xu75y2ov"> <summary class="astro-xu75y2ov"> <div class="group-label astro-xu75y2ov"> <span class="large astro-xu75y2ov">References</span>  </div> <svg aria-hidden="true" class="caret astro-xu75y2ov astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.25rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </summary> <ul class="astro-xu75y2ov"> <li class="astro-xu75y2ov"> <a href="/config/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Configuration Reference</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/directory-structure/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Directory structure</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/env-vars/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Environment variables</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/completion/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Command-line completion</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/diff-strategy/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Diff strategies</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/namespaces/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Namespaces</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/formatting/" aria-current="false" class="astro-xu75y2ov"> <span class="astro-xu75y2ov">Formatting</span>  </a> </li> </ul>  </details> </li><li class="astro-xu75y2ov"> <a href="/faq/" aria-current="false" class="large astro-xu75y2ov"> <span class="astro-xu75y2ov">Frequently asked questions</span>  </a> </li><li class="astro-xu75y2ov"> <a href="/known-issues/" aria-current="false" class="large astro-xu75y2ov"> <span class="astro-xu75y2ov">Known issues</span>  </a> </li> </ul>  <div class="md:sl-hidden"> <div class="mobile-preferences sl-flex astro-s3e7th2a"> <div class="sl-flex social-icons astro-s3e7th2a"> <a href="https://github.com/grafana/tanka" rel="me" class="sl-flex astro-7k65stkl"><span class="sr-only astro-7k65stkl">GitHub</span><svg aria-hidden="true" class="astro-7k65stkl astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"/></svg> </a> </div> <starlight-theme-select>  <label style="--sl-select-width: 6.25em" class="astro-hxjain2w"> <span class="sr-only astro-hxjain2w">Select theme</span> <svg aria-hidden="true" class="icon label-icon astro-hxjain2w astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21 14h-1V7a3 3 0 0 0-3-3H7a3 3 0 0 0-3 3v7H3a1 1 0 0 0-1 1v2a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3v-2a1 1 0 0 0-1-1ZM6 7a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v7H6V7Zm14 10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-1h16v1Z"/></svg>  <select value="auto" class="astro-hxjain2w"> <option value="dark" selected="false" class="astro-hxjain2w">Dark</option><option value="light" selected="false" class="astro-hxjain2w">Light</option><option value="auto" selected="true" class="astro-hxjain2w">Auto</option> </select> <svg aria-hidden="true" class="icon caret astro-hxjain2w astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M17 9.17a1 1 0 0 0-1.41 0L12 12.71 8.46 9.17a1 1 0 1 0-1.41 1.42l4.24 4.24a1.002 1.002 0 0 0 1.42 0L17 10.59a1.002 1.002 0 0 0 0-1.42Z"/></svg>  </label>  </starlight-theme-select>  <script>
	StarlightThemeProvider.updatePickers();
</script>   </div>  </div> </div> </div> </nav> <div class="main-frame astro-62xyixwj">  <div class="lg:sl-flex astro-osirz276"> <aside class="right-sidebar-container astro-osirz276"> <div class="right-sidebar astro-osirz276"> <div class="lg:sl-hidden astro-7ly3kvux"><mobile-starlight-toc data-min-h="2" data-max-h="3" class="astro-kasrnjty"><nav aria-labelledby="starlight__on-this-page--mobile" class="astro-kasrnjty"><details id="starlight__mobile-toc" class="astro-kasrnjty"><summary id="starlight__on-this-page--mobile" class="sl-flex astro-kasrnjty"><div class="toggle sl-flex astro-kasrnjty">On this page<svg aria-hidden="true" class="caret astro-kasrnjty astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1rem;"><path d="m14.83 11.29-4.24-4.24a1 1 0 1 0-1.42 1.41L12.71 12l-3.54 3.54a1 1 0 0 0 0 1.41 1 1 0 0 0 .71.29 1 1 0 0 0 .71-.29l4.24-4.24a1.002 1.002 0 0 0 0-1.42Z"/></svg> </div><span class="display-current astro-kasrnjty"></span></summary><div class="dropdown astro-kasrnjty"><ul class="isMobile astro-lbtmlupc" style="--depth: 0;"> <li class="astro-lbtmlupc" style="--depth: 0;"> <a href="./inline-environments/#_top" class="astro-lbtmlupc" style="--depth: 0;"> <span class="astro-lbtmlupc" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-lbtmlupc" style="--depth: 0;"> <a href="./inline-environments/#converting-to-an-inline-environment" class="astro-lbtmlupc" style="--depth: 0;"> <span class="astro-lbtmlupc" style="--depth: 0;">Converting to an inline environment</span> </a>  </li><li class="astro-lbtmlupc" style="--depth: 0;"> <a href="./inline-environments/#use-case-variable-apiserver" class="astro-lbtmlupc" style="--depth: 0;"> <span class="astro-lbtmlupc" style="--depth: 0;">Use case: variable apiServer</span> </a>  </li><li class="astro-lbtmlupc" style="--depth: 0;"> <a href="./inline-environments/#use-case-consistent-inline-environments" class="astro-lbtmlupc" style="--depth: 0;"> <span class="astro-lbtmlupc" style="--depth: 0;">Use case: consistent inline environments</span> </a>  </li><li class="astro-lbtmlupc" style="--depth: 0;"> <a href="./inline-environments/#caveats" class="astro-lbtmlupc" style="--depth: 0;"> <span class="astro-lbtmlupc" style="--depth: 0;">Caveats</span> </a> <ul class="isMobile astro-lbtmlupc" style="--depth: 1;"> <li class="astro-lbtmlupc" style="--depth: 1;"> <a href="./inline-environments/#import-tk" class="astro-lbtmlupc" style="--depth: 1;"> <span class="astro-lbtmlupc" style="--depth: 1;">import &quot;tk&quot;</span> </a>  </li><li class="astro-lbtmlupc" style="--depth: 1;"> <a href="./inline-environments/#tk-env" class="astro-lbtmlupc" style="--depth: 1;"> <span class="astro-lbtmlupc" style="--depth: 1;">tk env</span> </a>  </li> </ul>  </li> </ul> </div></details></nav></mobile-starlight-toc></div><div class="right-sidebar-panel sl-hidden lg:sl-block astro-7ly3kvux"><div class="sl-container astro-7ly3kvux"><starlight-toc data-min-h="2" data-max-h="3"><nav aria-labelledby="starlight__on-this-page"><h2 id="starlight__on-this-page">On this page</h2><ul class="astro-lbtmlupc" style="--depth: 0;"> <li class="astro-lbtmlupc" style="--depth: 0;"> <a href="./inline-environments/#_top" class="astro-lbtmlupc" style="--depth: 0;"> <span class="astro-lbtmlupc" style="--depth: 0;">Overview</span> </a>  </li><li class="astro-lbtmlupc" style="--depth: 0;"> <a href="./inline-environments/#converting-to-an-inline-environment" class="astro-lbtmlupc" style="--depth: 0;"> <span class="astro-lbtmlupc" style="--depth: 0;">Converting to an inline environment</span> </a>  </li><li class="astro-lbtmlupc" style="--depth: 0;"> <a href="./inline-environments/#use-case-variable-apiserver" class="astro-lbtmlupc" style="--depth: 0;"> <span class="astro-lbtmlupc" style="--depth: 0;">Use case: variable apiServer</span> </a>  </li><li class="astro-lbtmlupc" style="--depth: 0;"> <a href="./inline-environments/#use-case-consistent-inline-environments" class="astro-lbtmlupc" style="--depth: 0;"> <span class="astro-lbtmlupc" style="--depth: 0;">Use case: consistent inline environments</span> </a>  </li><li class="astro-lbtmlupc" style="--depth: 0;"> <a href="./inline-environments/#caveats" class="astro-lbtmlupc" style="--depth: 0;"> <span class="astro-lbtmlupc" style="--depth: 0;">Caveats</span> </a> <ul class="astro-lbtmlupc" style="--depth: 1;"> <li class="astro-lbtmlupc" style="--depth: 1;"> <a href="./inline-environments/#import-tk" class="astro-lbtmlupc" style="--depth: 1;"> <span class="astro-lbtmlupc" style="--depth: 1;">import &quot;tk&quot;</span> </a>  </li><li class="astro-lbtmlupc" style="--depth: 1;"> <a href="./inline-environments/#tk-env" class="astro-lbtmlupc" style="--depth: 1;"> <span class="astro-lbtmlupc" style="--depth: 1;">tk env</span> </a>  </li> </ul>  </li> </ul> </nav></starlight-toc></div></div> </div> </aside> <div class="main-pane astro-osirz276">  <main data-pagefind-body="true" lang="en" dir="ltr" class="astro-vikcuohw">    <div class="content-panel astro-y7w6jdlt"> <div class="sl-container astro-y7w6jdlt"> <h1 id="_top" class="astro-ifk2hsdc">Inline environments</h1>  </div> </div>  <div class="content-panel astro-y7w6jdlt"> <div class="sl-container astro-y7w6jdlt"> <div class="sl-markdown-content"> <p>Inline environments is the practice of defining the environment’s config inline
for evaluation at runtime as opposed to configuring it statically in
<code dir="auto">spec.json</code>.</p>
<p>The general take away is:</p>
<ul>
<li><code dir="auto">spec.json</code> will no longer be used</li>
<li><code dir="auto">main.jsonnet</code> is expected to render a <code dir="auto">tanka.dev/Environment</code> object</li>
<li>this object is expected to hold Kubernetes objects at <code dir="auto">.data</code></li>
</ul>
<h2 id="converting-to-an-inline-environment">Converting to an inline environment</h2>
<p>Converting a traditional <code dir="auto">spec.json</code> environment into an inline environment is quite
straight forward. Based on the example from <a href="./tutorial/jsonnet/">Using Jsonnet</a>:</p>
<p>The directory structure:</p>
<starlight-file-tree class="not-content astro-irhmq347" data-pagefind-ignore="true"><ul><li class="directory"><details open><summary><span class="tree-entry"><span class=""><span><span class="sr-only">Directory</span><svg width="16" height="16" class="tree-icon" aria-hidden="true" viewBox="0 0 24 24"><path d="M22.073 4.900L22.073 4.900L12.148 4.900L12.148 3.950Q12.148 3.125 11.585 2.563Q11.023 2 10.198 2L10.198 2L0.048 2L0.048 22L23.948 22L23.948 6.850Q23.998 6.025 23.448 5.462Q22.898 4.900 22.073 4.900Z"></path></svg></span>environments
</span></span></summary><ul><li class="directory"><details open><summary><span class="tree-entry"><span class=""><span><span class="sr-only">Directory</span><svg width="16" height="16" class="tree-icon" aria-hidden="true" viewBox="0 0 24 24"><path d="M22.073 4.900L22.073 4.900L12.148 4.900L12.148 3.950Q12.148 3.125 11.585 2.563Q11.023 2 10.198 2L10.198 2L0.048 2L0.048 22L23.948 22L23.948 6.850Q23.998 6.025 23.448 5.462Q22.898 4.900 22.073 4.900Z"></path></svg></span>default</span> <span class="comment"># default environment
</span></span></summary><ul><li class="file"><span class="tree-entry"><span class=""><span><svg width="16" height="16" class="tree-icon" aria-hidden="true" viewBox="0 0 24 24"><path d="M1.082 16.876L1.082 14.014L22.918 14.014L22.918 16.876L1.082 16.876ZM1.082 9.986L1.082 7.071L13.272 7.071L13.272 9.986L1.082 9.986ZM1.082 3.096L1.082 0.181L22.918 0.181L22.918 3.096L1.082 3.096ZM1.082 23.819L1.082 20.904L17.300 20.904L17.300 23.819L1.082 23.819Z"></path></svg></span>main.jsonnet</span> <span class="comment"># main file</span></span></li><li class="file"><span class="tree-entry"><span class=""><span><svg width="16" height="16" class="tree-icon" aria-hidden="true" viewBox="0 0 24 24"><path d="M0.734 13.269L0.562 10.732Q1.938 10.732 2.497 10.087L2.497 10.087Q2.884 9.614 2.884 8.711L2.884 8.711Q2.884 8.324 2.798 7.571Q2.712 6.819 2.712 6.410Q2.712 6.002 2.669 5.185L2.669 5.185Q2.583 4.454 2.583 4.153L2.583 4.153Q2.583 2.089 3.787 1.099Q4.991 0.111 7.184 0.111L7.184 0.111L8.259 0.111L8.259 2.648L7.700 2.648Q6.754 2.648 6.345 3.185Q5.937 3.723 5.937 4.798L5.937 4.798Q5.937 5.056 6.023 5.572L6.023 5.572Q6.109 6.217 6.109 6.561L6.109 6.561Q6.109 6.819 6.152 7.378L6.152 7.378Q6.238 8.152 6.238 8.582L6.238 8.582Q6.238 10.216 5.550 11.033L5.550 11.033Q4.948 11.764 3.658 12.065L3.658 12.065Q4.948 12.409 5.550 13.097L5.550 13.097Q6.238 13.957 6.238 15.548L6.238 15.548Q6.238 16.021 6.152 16.795L6.152 16.795Q6.066 17.354 6.088 17.612Q6.109 17.870 6.023 18.515L6.023 18.515Q5.937 18.988 5.937 19.203L5.937 19.203Q5.937 20.278 6.345 20.815Q6.754 21.353 7.700 21.353L7.700 21.353L8.259 21.353L8.259 23.890L7.184 23.890Q2.712 23.890 2.712 19.848L2.712 19.848Q2.712 18.386 2.862 17.590Q3.013 16.795 3.013 15.290L3.013 15.290Q3.013 13.269 0.734 13.269L0.734 13.269ZM23.438 10.732L23.438 13.011Q21.159 13.011 21.159 15.032L21.159 15.032Q21.159 15.419 21.224 16.171Q21.288 16.924 21.288 17.311L21.288 17.311Q21.417 18.128 21.417 19.590L21.417 19.590Q21.417 23.632 16.859 23.632L16.859 23.632L15.784 23.632L15.784 21.353L16.300 21.353Q17.246 21.353 17.654 20.815Q18.063 20.278 18.063 19.203Q18.063 18.128 17.934 17.569L17.934 17.569Q17.934 17.225 17.848 16.558Q17.762 15.892 17.762 15.548L17.762 15.548Q17.762 13.957 18.450 13.097L18.450 13.097Q19.052 12.409 20.342 12.065L20.342 12.065Q19.052 11.764 18.450 11.033L18.450 11.033Q17.762 10.216 17.762 8.582L17.762 8.582Q17.762 8.152 17.848 7.378L17.848 7.378Q17.934 6.819 17.934 6.561L17.934 6.561Q18.063 5.873 18.063 4.841Q18.063 3.809 17.633 3.293Q17.203 2.777 16.300 2.648L16.300 2.648L15.784 2.648L15.784 0.111L16.859 0.111Q19.009 0.111 20.213 1.099Q21.417 2.089 21.417 4.153L21.417 4.153Q21.417 4.540 21.352 5.292Q21.288 6.045 21.288 6.432L21.288 6.432Q21.159 7.249 21.116 8.711L21.116 8.711Q21.159 9.614 21.503 10.087L21.503 10.087Q22.062 10.732 23.438 10.732L23.438 10.732Z"></path></svg></span>spec.json</span> <span class="comment"># environment’s config</span></span></li></ul></details></li><li class="file"><span class="tree-entry"><span class=""><span><svg width="16" height="16" class="tree-icon" aria-hidden="true" viewBox="0 0 24 24"><path d="M0.734 13.269L0.562 10.732Q1.938 10.732 2.497 10.087L2.497 10.087Q2.884 9.614 2.884 8.711L2.884 8.711Q2.884 8.324 2.798 7.571Q2.712 6.819 2.712 6.410Q2.712 6.002 2.669 5.185L2.669 5.185Q2.583 4.454 2.583 4.153L2.583 4.153Q2.583 2.089 3.787 1.099Q4.991 0.111 7.184 0.111L7.184 0.111L8.259 0.111L8.259 2.648L7.700 2.648Q6.754 2.648 6.345 3.185Q5.937 3.723 5.937 4.798L5.937 4.798Q5.937 5.056 6.023 5.572L6.023 5.572Q6.109 6.217 6.109 6.561L6.109 6.561Q6.109 6.819 6.152 7.378L6.152 7.378Q6.238 8.152 6.238 8.582L6.238 8.582Q6.238 10.216 5.550 11.033L5.550 11.033Q4.948 11.764 3.658 12.065L3.658 12.065Q4.948 12.409 5.550 13.097L5.550 13.097Q6.238 13.957 6.238 15.548L6.238 15.548Q6.238 16.021 6.152 16.795L6.152 16.795Q6.066 17.354 6.088 17.612Q6.109 17.870 6.023 18.515L6.023 18.515Q5.937 18.988 5.937 19.203L5.937 19.203Q5.937 20.278 6.345 20.815Q6.754 21.353 7.700 21.353L7.700 21.353L8.259 21.353L8.259 23.890L7.184 23.890Q2.712 23.890 2.712 19.848L2.712 19.848Q2.712 18.386 2.862 17.590Q3.013 16.795 3.013 15.290L3.013 15.290Q3.013 13.269 0.734 13.269L0.734 13.269ZM23.438 10.732L23.438 13.011Q21.159 13.011 21.159 15.032L21.159 15.032Q21.159 15.419 21.224 16.171Q21.288 16.924 21.288 17.311L21.288 17.311Q21.417 18.128 21.417 19.590L21.417 19.590Q21.417 23.632 16.859 23.632L16.859 23.632L15.784 23.632L15.784 21.353L16.300 21.353Q17.246 21.353 17.654 20.815Q18.063 20.278 18.063 19.203Q18.063 18.128 17.934 17.569L17.934 17.569Q17.934 17.225 17.848 16.558Q17.762 15.892 17.762 15.548L17.762 15.548Q17.762 13.957 18.450 13.097L18.450 13.097Q19.052 12.409 20.342 12.065L20.342 12.065Q19.052 11.764 18.450 11.033L18.450 11.033Q17.762 10.216 17.762 8.582L17.762 8.582Q17.762 8.152 17.848 7.378L17.848 7.378Q17.934 6.819 17.934 6.561L17.934 6.561Q18.063 5.873 18.063 4.841Q18.063 3.809 17.633 3.293Q17.203 2.777 16.300 2.648L16.300 2.648L15.784 2.648L15.784 0.111L16.859 0.111Q19.009 0.111 20.213 1.099Q21.417 2.089 21.417 4.153L21.417 4.153Q21.417 4.540 21.352 5.292Q21.288 6.045 21.288 6.432L21.288 6.432Q21.159 7.249 21.116 8.711L21.116 8.711Q21.159 9.614 21.503 10.087L21.503 10.087Q22.062 10.732 23.438 10.732L23.438 10.732Z"></path></svg></span>jsonnetfile.json</span></span></li><li class="directory"><details><summary><span class="tree-entry"><span class=""><span><span class="sr-only">Directory</span><svg width="16" height="16" class="tree-icon" aria-hidden="true" viewBox="0 0 24 24"><path d="M22.073 4.900L22.073 4.900L12.148 4.900L12.148 3.950Q12.148 3.125 11.585 2.563Q11.023 2 10.198 2L10.198 2L0.048 2L0.048 22L23.948 22L23.948 6.850Q23.998 6.025 23.448 5.462Q22.898 4.900 22.073 4.900Z"></path></svg></span>lib/</span> <span class="comment"># libraries</span></span></summary><ul><li class="file empty"><span class="tree-entry"><span class="">…</span></span></li></ul></details></li><li class="directory"><details><summary><span class="tree-entry"><span class=""><span><span class="sr-only">Directory</span><svg width="16" height="16" class="tree-icon" aria-hidden="true" viewBox="0 0 24 24"><path d="M22.073 4.900L22.073 4.900L12.148 4.900L12.148 3.950Q12.148 3.125 11.585 2.563Q11.023 2 10.198 2L10.198 2L0.048 2L0.048 22L23.948 22L23.948 6.850Q23.998 6.025 23.448 5.462Q22.898 4.900 22.073 4.900Z"></path></svg></span>vendor/</span> <span class="comment"># external libraries</span></span></summary><ul><li class="file empty"><span class="tree-entry"><span class="">…</span></span></li></ul></details></li></ul></details></li></ul></starlight-file-tree> 
<p>The original files look like this:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.d6kn2.css"><script type="module" src="/_astro/ec.3zb7u.js"></script><figure class="frame has-title not-content"><figcaption class="header"><span class="title">main.jsonnet</span></figcaption><pre data-language="jsonnet"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">some_deployment:</span><span style="--0:#D6DEEB;--1:#403F53"> {</span><span style="--0:#809191;--1:#616671">/* ... */</span><span style="--0:#D6DEEB;--1:#403F53"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">some_service:</span><span style="--0:#D6DEEB;--1:#403F53"> {</span><span style="--0:#809191;--1:#616671">/* ... */</span><span style="--0:#D6DEEB;--1:#403F53"> },</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  some_deployment: {/* ... */ },  some_service: {/* ... */ },}"><div></div></button></div></figure></div>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">spec.json</span></figcaption><pre data-language="json"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#097174">"apiVersion"</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C789D6;--1:#7F5889">tanka.dev/v1alpha1</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#097174">"kind"</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C789D6;--1:#7F5889">Environment</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#097174">"metadata"</span><span style="--0:#D6DEEB;--1:#403F53">: {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#097174">"name"</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C789D6;--1:#7F5889">default</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">},</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#7FDBCA;--1:#097174">"spec"</span><span style="--0:#D6DEEB;--1:#403F53">: {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#097174">"apiServer"</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C789D6;--1:#7F5889">https://127.0.0.1:6443</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#097174">"namespace"</span><span style="--0:#D6DEEB;--1:#403F53">: </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#C789D6;--1:#7F5889">monitoring</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;apiVersion&#x22;: &#x22;tanka.dev/v1alpha1&#x22;,  &#x22;kind&#x22;: &#x22;Environment&#x22;,  &#x22;metadata&#x22;: {    &#x22;name&#x22;: &#x22;default&#x22;  },  &#x22;spec&#x22;: {    &#x22;apiServer&#x22;: &#x22;https://127.0.0.1:6443&#x22;,    &#x22;namespace&#x22;: &#x22;monitoring&#x22;  }}"><div></div></button></div></figure></div>
<p>Converting is as simple as bringing in the <code dir="auto">spec.json</code> into <code dir="auto">main.jsonnet</code> and
moving the original <code dir="auto">main.jsonnet</code> scope into the <code dir="auto">data:</code> element.</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">main.jsonnet</span></figcaption><pre data-language="jsonnet"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">apiVersion:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'tanka.dev/v1alpha1'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">kind:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'Environment'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">metadata:</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">name:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'default'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">spec:</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">apiServer:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'https://127.0.0.1:6443'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">namespace:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'monitoring'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">data:</span><span style="--0:#D6DEEB;--1:#403F53"> { </span><span style="--0:#809191;--1:#616671">// original main.jsonnet data</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">some_deployment:</span><span style="--0:#D6DEEB;--1:#403F53"> {</span><span style="--0:#809191;--1:#616671">/* ... */</span><span style="--0:#D6DEEB;--1:#403F53"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">some_service:</span><span style="--0:#D6DEEB;--1:#403F53"> {</span><span style="--0:#809191;--1:#616671">/* ... */</span><span style="--0:#D6DEEB;--1:#403F53"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">},</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  apiVersion: &#x27;tanka.dev/v1alpha1&#x27;,  kind: &#x27;Environment&#x27;,  metadata: {    name: &#x27;default&#x27;,  },  spec: {    apiServer: &#x27;https://127.0.0.1:6443&#x27;,    namespace: &#x27;monitoring&#x27;,  },  data: { // original main.jsonnet data    some_deployment: {/* ... */ },    some_service: {/* ... */ },  },}"><div></div></button></div></figure></div>
<h2 id="use-case-variable-apiserver">Use case: variable apiServer</h2>
<p>Even though the <code dir="auto">apiServer</code> directive is originally meant to prevent that the
manifests don’t get accidentally applied to the wrong Kubernetes cluster, there
is a valid use case for making the <code dir="auto">apiServer</code> variable: Local test clusters.</p>
<p>Instead of modifying <code dir="auto">spec.json</code> each time, with inline environments it is
possible to leverage powerful jsonnet concepts, for example with top level
arguments:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">environments/minikube-test-setup/main.jsonnet</span></figcaption><pre data-language="jsonnet"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">function</span><span style="--0:#D6DEEB;--1:#403F53">(apiServer) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">apiVersion:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'tanka.dev/v1alpha1'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">kind:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'Environment'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">metadata:</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">name:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'minikube-test-setup'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">spec:</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">apiServer:</span><span style="--0:#D6DEEB;--1:#403F53"> apiServer,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">namespace:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'monitoring'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">data:</span><span style="--0:#D6DEEB;--1:#403F53"> { </span><span style="--0:#809191;--1:#616671">/* ... */</span><span style="--0:#D6DEEB;--1:#403F53"> },</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="function(apiServer) {  apiVersion: &#x27;tanka.dev/v1alpha1&#x27;,  kind: &#x27;Environment&#x27;,  metadata: {    name: &#x27;minikube-test-setup&#x27;,  },  spec: {    apiServer: apiServer,    namespace: &#x27;monitoring&#x27;,  },  data: { /* ... */ },}"><div></div></button></div></figure></div>
<p>Applying this to a local Kubernetes cluster can be done like this:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">tk</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apply</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">--tla-str</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apiServer=https://127.0.0.1:4758</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">environments/minikube-test-setup</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="tk apply --tla-str apiServer=https://127.0.0.1:4758 environments/minikube-test-setup"><div></div></button></div></figure></div>
<p>Similarly this can be used to configure any part of the Environment object, like
<code dir="auto">namespace:</code>, <code dir="auto">metadata.labels</code>, …</p>
<h2 id="use-case-consistent-inline-environments">Use case: consistent inline environments</h2>
<p>It is possible to define multiple inline environments in a single jsonnet. This
enables an operator to generate consistent Tanka environments for multiple
Kubernetes clusters.</p>
<p>We can define a Tanka environment once and then repeat that for a set of
clusters as shown in this example:</p>
<div class="expressive-code"><figure class="frame has-title not-content"><figcaption class="header"><span class="title">environments/monitoring-stack/main.jsonnet</span></figcaption><pre data-language="jsonnet"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">environment</span><span style="--0:#D6DEEB;--1:#403F53">(cluster)</span><span style="--0:#7FDBCA;--1:#097174">::</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">apiVersion:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'tanka.dev/v1alpha1'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">kind:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'Environment'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">metadata:</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">      </span></span><span style="--0:#D7DBE0;--1:#403F53">name:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'environment/%s'</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#097174">%</span><span style="--0:#D6DEEB;--1:#403F53"> cluster.name,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">spec:</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">      </span></span><span style="--0:#D7DBE0;--1:#403F53">apiServer:</span><span style="--0:#D6DEEB;--1:#403F53"> cluster.apiServer,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">      </span></span><span style="--0:#D7DBE0;--1:#403F53">namespace:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'monitoring'</span><span style="--0:#D6DEEB;--1:#403F53">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">},</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">    </span></span><span style="--0:#D7DBE0;--1:#403F53">data:</span><span style="--0:#D6DEEB;--1:#403F53"> { </span><span style="--0:#809191;--1:#616671">/* ... */</span><span style="--0:#D6DEEB;--1:#403F53"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">},</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">clusters:: [</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">{ </span><span style="--0:#D7DBE0;--1:#403F53">name:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'us-central1'</span><span style="--1:#403F53"><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">apiServer:</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#ECC48D;--1:#9B504E">'https://127.0.0.1:6433'</span><span style="--0:#D6DEEB;--1:#403F53"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">{ </span><span style="--0:#D7DBE0;--1:#403F53">name:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#9B504E">'europe-west2'</span><span style="--1:#403F53"><span style="--0:#D6DEEB">, </span><span style="--0:#D7DBE0">apiServer:</span><span style="--0:#D6DEEB"> </span></span><span style="--0:#ECC48D;--1:#9B504E">'https://127.0.0.2:6433'</span><span style="--0:#D6DEEB;--1:#403F53"> },</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">],</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--1:#403F53">  </span></span><span style="--0:#D7DBE0;--1:#403F53">envs:</span><span style="--0:#D6DEEB;--1:#403F53"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">[cluster.name]</span><span style="--0:#7FDBCA;--1:#097174">:</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">$</span><span style="--0:#D6DEEB;--1:#403F53">.</span><span style="--0:#82AAFF;--1:#3C63B3">environment</span><span style="--0:#D6DEEB;--1:#403F53">(cluster)</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8D46B4">for</span><span style="--0:#D6DEEB;--1:#403F53"> cluster </span><span style="--0:#C792EA;--1:#8D46B4">in</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#C792EA;--1:#8D46B4">$</span><span style="--0:#D6DEEB;--1:#403F53">.clusters</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">  </span></span><span style="--0:#D6DEEB;--1:#403F53">},</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  environment(cluster):: {    apiVersion: &#x27;tanka.dev/v1alpha1&#x27;,    kind: &#x27;Environment&#x27;,    metadata: {      name: &#x27;environment/%s&#x27; % cluster.name,    },    spec: {      apiServer: cluster.apiServer,      namespace: &#x27;monitoring&#x27;,    },    data: { /* ... */ },  },  clusters:: [    { name: &#x27;us-central1&#x27;, apiServer: &#x27;https://127.0.0.1:6433&#x27; },    { name: &#x27;europe-west2&#x27;, apiServer: &#x27;https://127.0.0.2:6433&#x27; },  ],  envs: {    [cluster.name]: $.environment(cluster)    for cluster in $.clusters  },}"><div></div></button></div></figure></div>
<p>In the workflow you now have to use <code dir="auto">--name</code> to select the environment you want
to deploy:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">tk</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apply</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">--name</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">environment/us-central1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">environments/monitoring-stack/main.jsonnet</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">tk</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">diff</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">--name</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">environment/europe-west2</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">environments/monitoring-stack/main.jsonnet</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#809191;--1:#616671"># Partial matches also work (if they match a single environment)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">tk</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">apply</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">--name</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">us-central1</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">environments/monitoring-stack/main.jsonnet</span></div></div><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">tk</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">diff</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">--name</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">west2</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">environments/monitoring-stack/main.jsonnet</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="tk apply --name environment/us-central1 environments/monitoring-stack/main.jsonnettk diff --name environment/europe-west2 environments/monitoring-stack/main.jsonnettk apply --name us-central1 environments/monitoring-stack/main.jsonnettk diff --name west2 environments/monitoring-stack/main.jsonnet"><div></div></button></div></figure></div>
<p>For export, it is possible to use the same <code dir="auto">--name</code> selector or you can do a
recursive export while using the <code dir="auto">--format</code> option:</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3C63B3">tk</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">export</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">outputDir/</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3C63B3">environments/monitoring-stack/main.jsonnet</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3C63B3">--recursive</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">\</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#82AAFF;--1:#3C63B3">--format</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">'</span><span style="--0:#ECC48D;--1:#9B504E">{{env.metadata.name}}/{{.metadata.namespace}}/{{.kind}}-{{.metadata.name}}</span><span style="--0:#D9F5DD;--1:#111111">'</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="tk export outputDir/ environments/monitoring-stack/main.jsonnet --recursive \  --format &#x27;{{env.metadata.name}}/{{.metadata.namespace}}/{{.kind}}-{{.metadata.name}}&#x27;"><div></div></button></div></figure></div>
<h2 id="caveats">Caveats</h2>
<h3 id="import-tk"><code dir="auto">import "tk"</code></h3>
<p>Inline environments cannot use <a href="./config/#jsonnet-access"><code dir="auto">import "tk"</code></a> anymore as
this information was populated before jsonnet evaluation by the existence of
<code dir="auto">spec.json</code>.</p>
<h3 id="tk-env"><code dir="auto">tk env</code></h3>
<p>The different <code dir="auto">tk env</code> subcommands are heavily based on the <code dir="auto">spec.json</code>
approach. <code dir="auto">tk env list</code> will continue to work as expected, <code dir="auto">tk env (add|remove|set)</code> will only work for <code dir="auto">spec.json</code> based environments.</p> </div> <footer class="sl-flex astro-ytrm53vb"> <div class="meta sl-flex astro-ytrm53vb"> <a href="https://github.com/grafana/tanka/edit/main/docs/src/content/docs/inline-environments.mdx" class="sl-flex astro-knky34k4"><svg aria-hidden="true" class="astro-knky34k4 astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.2em;"><path d="M22 7.24a1 1 0 0 0-.29-.71l-4.24-4.24a1 1 0 0 0-1.1-.22 1 1 0 0 0-.32.22l-2.83 2.83L2.29 16.05a1 1 0 0 0-.29.71V21a1 1 0 0 0 1 1h4.24a1 1 0 0 0 .76-.29l10.87-10.93L21.71 8c.1-.1.17-.2.22-.33a1 1 0 0 0 0-.24v-.14l.07-.05ZM6.83 20H4v-2.83l9.93-9.93 2.83 2.83L6.83 20ZM18.17 8.66l-2.83-2.83 1.42-1.41 2.82 2.82-1.41 1.42Z"/></svg> Edit page</a>  </div> <div class="pagination-links astro-ucp543br" dir="ltr"> <a href="/exporting/" rel="prev" class="astro-ucp543br"> <svg aria-hidden="true" class="astro-ucp543br astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17 11H9.41l3.3-3.29a1.004 1.004 0 1 0-1.42-1.42l-5 5a1 1 0 0 0-.21.33 1 1 0 0 0 0 .76 1 1 0 0 0 .21.33l5 5a1.002 1.002 0 0 0 1.639-.325 1 1 0 0 0-.219-1.095L9.41 13H17a1 1 0 0 0 0-2Z"/></svg>  <span class="astro-ucp543br"> Previous <br class="astro-ucp543br"> <span class="link-title astro-ucp543br">Exporting as YAML</span> </span> </a> <a href="/server-side-apply/" rel="next" class="astro-ucp543br"> <svg aria-hidden="true" class="astro-ucp543br astro-vmjkirbm" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.92 11.62a1.001 1.001 0 0 0-.21-.33l-5-5a1.003 1.003 0 1 0-1.42 1.42l3.3 3.29H7a1 1 0 0 0 0 2h7.59l-3.3 3.29a1.002 1.002 0 0 0 .325 1.639 1 1 0 0 0 1.095-.219l5-5a1 1 0 0 0 .21-.33 1 1 0 0 0 0-.76Z"/></svg>  <span class="astro-ucp543br"> Next <br class="astro-ucp543br"> <span class="link-title astro-ucp543br">Server-Side Apply</span> </span> </a> </div>   </footer>  </div> </div>   </main> </div> </div>  </div> </div>  </body></html>